{"meta":{"type":"db","canSave":true,"canEdit":true,"canStar":true,"slug":"ceph-osd-latency","expires":"0001-01-01T00:00:00Z","created":"2017-07-05T02:54:44Z","updated":"2017-07-06T22:01:38Z","updatedBy":"admin@localhost","createdBy":"admin@localhost","version":7},"dashboard":{"annotations":{"list":[]},"editable":false,"gnetId":null,"graphTooltip":0,"hideControls":true,"id":39,"links":[],"refresh":"10s","rows":[{"collapse":false,"height":250,"panels":[{"content":"\u003ch1\u003eCeph I/O Process Overview\u003c/h1\u003e\n\u003cp style=\"text-align: justify;\"\u003e\nA write request is issued to a 'primary' OSD and committed to a journal using direct-io (\u003ci\u003e\u003cb\u003eapply\u003c/b\u003e\u003c/i\u003e). Once this write is complete, the data is persisted to HDD by a second 'buffered' write operation (\u003ci\u003e\u003cb\u003ecommit\u003c/b\u003e\u003c/i\u003e). The commit operation is basically a measure of time taken to perform a \u003ci\u003esyncfs\u003c/i\u003e call to flush dirty pages to disk, and is therefore \u003cb\u003enot\u003c/b\u003e a time associated with any specific client initiated operation.\u003cp\u003e The tables on the right show the top 10 OSDs with the highest latencies.\n","id":10,"links":[],"mode":"html","span":4,"title":"","type":"text"},{"columns":[{"text":"Current","value":"current"}],"description":"Time spent in the queue for the journal. Excessive times here may indicate OSD tthrottling is happening. In this scenario you should review the OSD specific settings in \"ceph.conf\"; filestore_queue_max_ops or filestore_queue_max_bytes","fontSize":"100%","id":3,"links":[],"minSpan":2,"pageSize":null,"scroll":true,"showHeader":true,"sort":{"col":1,"desc":true},"span":2,"styles":[{"alias":"Time","dateFormat":"YYYY-MM-DD HH:mm:ss","pattern":"Time","type":"date"},{"alias":"Journal Queue Time","colorMode":"row","colors":["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"Current","thresholds":[".001",".003"],"type":"number","unit":"s"},{"alias":"OSD Id","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"Metric","thresholds":[],"type":"number","unit":"short"},{"alias":"","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"decimals":2,"pattern":"/.*/","thresholds":[],"type":"number","unit":"short"}],"targets":[{"refId":"A","target":"aliasByNode(limit(sortByMaxima(collectd.*.$domain.cephmetrics.gauge.$cluster_name.osd.*.queue_transaction_latency_avg),$max_devices),-2)","textEditor":true}],"title":"","transform":"timeseries_aggregations","type":"table"},{"columns":[{"text":"Current","value":"current"}],"description":"Time taken for the write request to be safely committed to the journal device","fontSize":"100%","id":4,"links":[],"minSpan":2,"pageSize":null,"scroll":true,"showHeader":true,"sort":{"col":1,"desc":true},"span":2,"styles":[{"alias":"Time","dateFormat":"YYYY-MM-DD HH:mm:ss","pattern":"Time","type":"date"},{"alias":"Journal Latency","colorMode":"row","colors":["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"Current","thresholds":["0.01","0.1"],"type":"number","unit":"s"},{"alias":"OSD Id","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"Metric","thresholds":[],"type":"number","unit":"short"},{"alias":"","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"decimals":2,"pattern":"/.*/","thresholds":[],"type":"number","unit":"short"}],"targets":[{"refId":"A","target":"aliasByNode(limit(sortByMaxima(collectd.*.$domain.cephmetrics.gauge.$cluster_name.osd.*.journal_latency),$max_devices),-2)","textEditor":true}],"title":"","transform":"timeseries_aggregations","type":"table"},{"columns":[{"text":"Current","value":"current"}],"description":"Apply latency covers the time taken to commit to the journal and complete the transaction","fontSize":"100%","id":5,"links":[],"minSpan":2,"pageSize":null,"scroll":true,"showHeader":true,"sort":{"col":1,"desc":true},"span":2,"styles":[{"alias":"Time","dateFormat":"YYYY-MM-DD HH:mm:ss","pattern":"Time","type":"date"},{"alias":"Apply Latency","colorMode":"row","colors":["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"Current","thresholds":["100","500"],"type":"number","unit":"s"},{"alias":"OSD Id","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"Metric","thresholds":[],"type":"number","unit":"short"},{"alias":"","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"decimals":2,"pattern":"/.*/","thresholds":[],"type":"number","unit":"short"}],"targets":[{"refId":"A","target":"aliasByNode(limit(sortByMaxima(collectd.*.$domain.cephmetrics.gauge.$cluster_name.osd.*.apply_latency),$max_devices),-2)","textEditor":true}],"title":"","transform":"timeseries_aggregations","type":"table"},{"columns":[{"text":"Current","value":"current"}],"description":"Commit latency is the time taken for writes to be flushed to disk as part of async kernel activity","fontSize":"100%","id":6,"links":[],"minSpan":2,"pageSize":null,"scroll":true,"showHeader":true,"sort":{"col":1,"desc":true},"span":2,"styles":[{"alias":"Time","dateFormat":"YYYY-MM-DD HH:mm:ss","pattern":"Time","type":"date"},{"alias":"Commit Latency","colorMode":"row","colors":["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"Current","thresholds":["1","3"],"type":"number","unit":"s"},{"alias":"OSD Id","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"Metric","thresholds":[],"type":"number","unit":"short"},{"alias":"","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"decimals":2,"pattern":"/.*/","thresholds":[],"type":"number","unit":"short"}],"targets":[{"refId":"A","target":"aliasByNode(limit(sortByMaxima(collectd.*.$domain.cephmetrics.gauge.$cluster_name.osd.*.commitcycle_latency),$max_devices),-2)","textEditor":true}],"title":"","transform":"timeseries_aggregations","type":"table"}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"OSD Latency Summary","titleSize":"h5"},{"collapse":false,"height":"250px","panels":[{"aliasColors":{"95%ile Commit Latency":"#447EBC","Apply Latency Max":"#890F02"},"bars":false,"dashLength":10,"dashes":false,"datasource":null,"fill":0,"id":1,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"minSpan":6,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"Apply Latency Max","fill":0},{"alias":"95%ile Apply Latency","fill":2}],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"refId":"A","target":"alias(percentileOfSeries(collectd.*.$domain.cephmetrics.gauge.$cluster_name.osd.*.apply_latency,$percentile), \"$percentile%ile Apply Latency\")","textEditor":true},{"refId":"B","target":"alias(percentileOfSeries(collectd.*.$domain.cephmetrics.gauge.$cluster_name.osd.*.commitcycle_latency, $percentile), \"$percentile%ile Commit Latency\")","textEditor":true}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Commit vs Apply Latency @ $percentile%ile","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"All OSDs","titleSize":"h5"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":null,"fill":1,"id":9,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"span":12,"stack":false,"steppedLine":false,"targets":[{"refId":"A","target":"alias(percentileOfSeries(collectd.*.$domain.cephmetrics.gauge.$cluster_name.osd.*.queue_transaction_latency_avg,$percentile), \"journal Queue time\")","textEditor":true},{"refId":"B","target":"alias(percentileOfSeries(collectd.*.$domain.cephmetrics.gauge.$cluster_name.osd.*.journal_latency,$percentile), \"journal Latency\")","textEditor":true},{"refId":"C","target":"alias(percentileOfSeries(collectd.*.$domain.cephmetrics.gauge.$cluster_name.osd.*.apply_latency,$percentile), \"apply Latency\")","textEditor":true},{"refId":"D","target":"alias(percentileOfSeries(collectd.*.$domain.cephmetrics.gauge.$cluster_name.osd.*.commitcycle_latency,$percentile), \"commit/flush Latency\")","textEditor":true}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"IO Summary across all OSD's @ $percentile%ile","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"}],"schemaVersion":14,"style":"dark","tags":[],"templating":{"list":[{"allValue":null,"current":{"selected":true,"text":"storage.lab","value":"storage.lab"},"hide":2,"includeAll":false,"label":null,"multi":false,"name":"domain","options":[{"selected":true,"text":"storage.lab","value":"storage.lab"}],"query":"storage.lab","type":"custom"},{"allValue":null,"current":{"text":"ceph","value":"ceph"},"datasource":"Local","hide":2,"includeAll":false,"label":null,"multi":false,"name":"cluster_name","options":[],"query":"collectd.*.$domain.cephmetrics.gauge.*","refresh":1,"regex":"","sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"selected":true,"text":"95","value":"95"},"hide":0,"includeAll":false,"label":null,"multi":false,"name":"percentile","options":[{"selected":true,"text":"95","value":"95"},{"selected":false,"text":"96","value":"96"},{"selected":false,"text":"97","value":"97"},{"selected":false,"text":"98","value":"98"},{"selected":false,"text":"99","value":"99"}],"query":"95,96,97,98,99","type":"custom"},{"allValue":null,"current":{"text":"10","value":"10"},"hide":2,"includeAll":false,"label":null,"multi":false,"name":"max_devices","options":[{"selected":true,"text":"10","value":"10"}],"query":"10","type":"custom"}]},"time":{"from":"now-1h","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"browser","title":"Ceph - OSD Latency","version":7}}